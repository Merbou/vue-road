{"version":3,"file":"index.js","sources":["../src/middleware.js","../src/index.js"],"sourcesContent":["export default class middleware {\r\n\r\n    constructor({router, middlewares,route}) {\r\n\r\n        if (!middlewares||!route) return;\r\n        this.middlewares = middlewares\r\n        this.route = route\r\n\r\n        router.beforeEach((to, from, next) => {\r\n            this.standrad({ to, from, next }, \"before\")\r\n        })\r\n\r\n        router.afterEach((to, from) => {\r\n            this.standrad({ to, from }, \"after\")\r\n        })\r\n\r\n    }\r\n\r\n    standrad({ to, from, next }, doctrine) {\r\n        let _ro_ms = this.route.get()\r\n            .filter(e => e.routes.findIndex(e => e.path === to.path.split(\"/\").slice(0, 2).join(\"/\")) > -1)\r\n            .flatMap(e => e.middlewares)\r\n\r\n        _ro_ms.forEach(_ro_m => {\r\n            if (Object.keys(this.middlewares).indexOf(_ro_m) > -1 && this.middlewares[_ro_m][doctrine])\r\n                if (doctrine == \"before\")\r\n                    this.middlewares[_ro_m][doctrine]({ to, from })\r\n                        .then(res => {\r\n                            if (res === to.path) next()\r\n                            else\r\n                                res ? next(res) : next()\r\n                        })\r\n                        .catch(code => {\r\n\r\n                            if (res === to.path) next()\r\n                            else\r\n                                next(code)\r\n                        })\r\n                else\r\n                    this.middlewares[_ro_m][doctrine]({ to, from })\r\n\r\n        })\r\n    }\r\n\r\n\r\n}","import midd from \"./middleware\";\r\n//_w : way\r\n//_ro : route\r\n//_rs : routes\r\n//_rs_mds : routes_middleswares\r\nexport default class road {\r\n    constructor($callback, customRouteCase) {\r\n        this.customRouteCase = customRouteCase\r\n        this._rs_mds = [];\r\n        this.ROUTES = [];\r\n        //callback with this object\r\n        $callback.call(this);\r\n    }\r\n\r\n\r\n    middleware({ router, middlewares }) {\r\n        new midd({ router, middlewares, route: this })\r\n        return this\r\n    }\r\n    /**\r\n     * assignment all routes to attribut _ro \r\n     * \r\n     * @param {String} middleware \r\n     * @param {Array} _rs \r\n     */\r\n    route(_rs, middleware) {\r\n        let middlewares = this.splitMiddleware(middleware)\r\n        //assignment a routes with middlewares index to ROUTES array\r\n        this.ROUTES.push({ routes: [..._rs], middlewares })\r\n\r\n        //Handle each route customRouteCase is callback \r\n        _rs = this.customRouteCase ? this.customRouteCase(_rs) : this.routeCase(_rs)\r\n        //assignment a routes with middlewares index to _ro array\r\n        this._rs_mds.push({ routes: _rs, middlewares });\r\n        return _rs\r\n    }\r\n\r\n    /**\r\n    * create objects of route vueRouter form simple object\r\n    * \r\n    * @param {Array} routes\r\n    */\r\n    routeCase(routes) {\r\n        return routes.map(_ro => {\r\n            let { children, ..._ro_params } = _ro\r\n            let route = {\r\n                ..._ro_params,\r\n                children: children && this.routeCase(children)\r\n            }\r\n            return route\r\n        })\r\n    }\r\n    splitMiddleware(middleware) {\r\n        try {\r\n            if (Array.isArray(middleware)) return middleware\r\n            if (typeof middleware === \"string\") return middleware.split(\",\")\r\n            throw \"middleware not valid\"\r\n        } catch (error) {\r\n            return [\"init\"]\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * get middleswars from routes\r\n     */\r\n    getMiddleswares() {\r\n        return [...new Set(this.ROUTES.flatMap(_rs => _rs.middlewares))]\r\n    }\r\n\r\n    /**\r\n     * \r\n     * return all routes as array of vue Router object(route)\r\n     */\r\n    constant() {\r\n        return (this._rs_mds && this._rs_mds.map(e => e.routes).flatMap(e => e)) || []\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {String|Array} middlewares \r\n     * return routes according to middleware\r\n     */\r\n    get(middlewares) {\r\n        if (!middlewares) return this.ROUTES\r\n        middlewares = Array.isArray(middlewares) ? middlewares : [middlewares]\r\n        return this.ROUTES.\r\n            filter(_r => _r.middlewares.filter(_m => middlewares.indexOf(_m) > -1).length)\r\n            .flatMap(_r => _r.routes)\r\n    }\r\n}\r\n\r\n\r\n"],"names":["middleware","router","middlewares","route","beforeEach","to","from","next","_this","standrad","afterEach","doctrine","this","get","filter","e","routes","findIndex","path","split","slice","join","flatMap","forEach","_ro_m","Object","keys","_this2","indexOf","then","res","code","road","$callback","customRouteCase","_rs_mds","ROUTES","call","midd","_rs","splitMiddleware","push","routeCase","map","_ro","children","_ro_params","Array","isArray","error","Set","_r","_m","length"],"mappings":";;;;;46CAAqBA,sCAEJC,IAAAA,OAAQC,IAAAA,YAAYC,IAAAA,gBAExBD,GAAcC,SACdD,YAAcA,OACdC,MAAQA,EAEbF,EAAOG,YAAW,SAACC,EAAIC,EAAMC,GACzBC,EAAKC,SAAS,CAAEJ,GAAAA,EAAIC,KAAAA,EAAMC,KAAAA,GAAQ,aAGtCN,EAAOS,WAAU,SAACL,EAAIC,GAClBE,EAAKC,SAAS,CAAEJ,GAAAA,EAAIC,KAAAA,GAAQ,0DAKPK,cAAlBN,IAAAA,GAAIC,IAAAA,KAAMC,IAAAA,KACJK,KAAKT,MAAMU,MACnBC,QAAO,SAAAC,UAAKA,EAAEC,OAAOC,WAAU,SAAAF,UAAKA,EAAEG,OAASb,EAAGa,KAAKC,MAAM,KAAKC,MAAM,EAAG,GAAGC,KAAK,SAAS,KAC5FC,SAAQ,SAAAP,UAAKA,EAAEb,eAEbqB,SAAQ,SAAAC,GACPC,OAAOC,KAAKC,EAAKzB,aAAa0B,QAAQJ,IAAU,GAAKG,EAAKzB,YAAYsB,GAAOb,KAC7D,UAAZA,EACAgB,EAAKzB,YAAYsB,GAAOb,GAAU,CAAEN,GAAAA,EAAIC,KAAAA,IACnCuB,MAAK,SAAAC,GACEA,IAAQzB,EAAGa,KAAMX,IAEjBuB,EAAMvB,EAAKuB,GAAOvB,cAEnB,SAAAwB,GAECD,MAAQzB,EAAGa,KAAMX,IAEjBA,EAAKwB,MAGjBJ,EAAKzB,YAAYsB,GAAOb,GAAU,CAAEN,GAAAA,EAAIC,KAAAA,iBClCvC0B,wBACLC,EAAWC,kBACdA,gBAAkBA,OAClBC,QAAU,QACVC,OAAS,GAEdH,EAAUI,KAAKzB,0DAINX,IAAAA,OAAQC,IAAAA,uBACboC,EAAK,CAAErC,OAAAA,EAAQC,YAAAA,EAAaC,MAAOS,OAChCA,mCAQL2B,EAAKvC,OACHE,EAAcU,KAAK4B,gBAAgBxC,eAElCoC,OAAOK,KAAK,CAAEzB,SAAYuB,GAAMrC,YAAAA,IAGrCqC,EAAM3B,KAAKsB,gBAAkBtB,KAAKsB,gBAAgBK,GAAO3B,KAAK8B,UAAUH,QAEnEJ,QAAQM,KAAK,CAAEzB,OAAQuB,EAAKrC,YAAAA,IAC1BqC,oCAQDvB,qBACCA,EAAO2B,KAAI,SAAAC,OACRC,EAA4BD,EAA5BC,SAAaC,IAAeF,wCAE3BE,GACHD,SAAUA,GAAYrC,EAAKkC,UAAUG,gDAKjC7C,UAEJ+C,MAAMC,QAAQhD,GAAa,OAAOA,KACZ,iBAAfA,EAAyB,OAAOA,EAAWmB,MAAM,UACtD,uBACR,MAAO8B,SACE,CAAC,4DASD,IAAIC,IAAItC,KAAKwB,OAAOd,SAAQ,SAAAiB,UAAOA,EAAIrC,2DAQ1CU,KAAKuB,SAAWvB,KAAKuB,QAAQQ,KAAI,SAAA5B,UAAKA,EAAEC,UAAQM,SAAQ,SAAAP,UAAKA,MAAO,+BAQ5Eb,UACKA,GACLA,EAAc6C,MAAMC,QAAQ9C,GAAeA,EAAc,CAACA,GACnDU,KAAKwB,OACRtB,QAAO,SAAAqC,UAAMA,EAAGjD,YAAYY,QAAO,SAAAsC,UAAMlD,EAAY0B,QAAQwB,IAAO,KAAGC,UACtE/B,SAAQ,SAAA6B,UAAMA,EAAGnC,WAJGJ,KAAKwB"}